
1. подмножества языка sql
язык sql делится на четыре основных подмножества по функционалу:

    ddl (data definition language) — команды для определения и изменения структуры бд: create, alter, drop.
    dml (data manipulation language) — команды для работы с данными в таблицах: select, insert, update, delete.
    dcl (data control language) — команды управления доступом и правами: grant, revoke.
    tcl (transaction control language) — команды управления транзакциями: commit, rollback, save transaction

2. реляционные базы данных. основные понятия
реляционная база данных хранит информацию в виде набора взаимосвязанных таблиц. основные понятия включают:

    сущность (entity) — объект, о котором хранится информация, соответствует таблице.
    атрибут (attribute) — характеристика сущности, соответствует столбцу таблицы.
    кортеж (tuple) — набор значений атрибутов, соответствует строке или записи.
    домен (domain) — набор допустимых значений для атрибута, например, только положительные целые числа.
    схема (schema) — логическая структура базы данных, описывающая таблицы и их связи

3. атрибуты столбца в sql
при создании или изменении столбца в sql ему присваиваются атрибуты, определяющие его поведение и ограничения:

    тип данных (data type) — определяет вид хранимой информации (int, varchar, datetime).
    not null / null — определяет, может ли столбец содержать пустое значение.
    default — задает значение, которое будет вставлено, если явно не указано другое.
    identity (в mssql) — обеспечивает автоматическое увеличение числового значения для каждой новой строки (автоинкремент).
    unique — гарантирует уникальность значений в столбце по всей таблице

4. основные типы данных в mssql
microsoft sql server предлагает богатый набор типов данных. основные из них:

    точная числовая информация: int (целое число), decimal(p, s) или numeric (десятичное с фиксированной точностью, подходит для денег).
    приблизительная числовая информация: float, real.
    символьная информация: varchar(n) (не юникод), nvarchar(n) (юникод, для русского языка), char(n), nchar(n).
    дата и время: date (только дата), time (только время), datetime2 (дата и время с высокой точностью), datetime (старый тип даты и времени).
    другие: bit (0 или 1), uniqueidentifier (guid)

5. соединения в sql
соединения (joins) используются для объединения строк из двух или более таблиц на основе логической связи между ними. они указываются в секции from команды select. типы соединений включают inner, left outer, right outer, full outer и cross join
6. первичный ключ
первичный ключ (primary key, pk) — это уникальный идентификатор для каждой строки в таблице. он гарантирует, что каждая запись уникальна. ключевые свойства первичного ключа:

    уникальность: значения не могут повторяться в столбце.
    не null: поле первичного ключа не может быть пустым.
    стабильность: значение pk должно редко меняться.
    таблица может иметь только один первичный ключ

7. ограничения (constraints)
ограничения sql используются для указания правил для данных в таблице, обеспечивая целостность и точность информации. основные типы:

    not null: столбец не может содержать null.
    unique: все значения в столбце должны быть уникальными.
    primary key: уникальный и не-null идентификатор строки.
    foreign key: обеспечивает ссылочную целостность между таблицами.
    check: гарантирует, что все значения в столбце соответствуют определенному условию.
    default: задает значение по умолчанию для столбца

8. первая нормальная форма (1нф)
первая нормальная форма (1nf) является базовым требованием к реляционным базам данных. она требует, чтобы каждый атрибут (столбец) в таблице содержал только атомарные (неделимые) значения. это означает, что не должно быть повторяющихся групп атрибутов или списков значений внутри одной ячейки (например, список номеров телефонов в одном поле)
9. вторая нормальная форма (2нф)
вторая нормальная форма (2nf) основывается на 1нф и устраняет частичные зависимости. если первичный ключ состоит из нескольких столбцов (составной ключ), то все неключевые атрибуты должны зависеть от всего первичного ключа, а не только от его части
10. третья нормальная форма (3нф)
третья нормальная форма (3nf) основывается на 2нф и устраняет транзитивные зависимости. это означает, что неключевые атрибуты не должны зависеть друг от друга. каждое неключевое поле должно зависеть только от первичного ключа, а не от других неключевых полей (например, город не должен зависеть от почтового индекса, который сам зависит от pk)
11. нормальная форма бойса-кодда (бкнф)
нормальная форма бойса-кодда (bcnf, 3.5nf) является более строгой версией третьей нормальной формы. она требует, чтобы каждый детерминант (атрибут или набор атрибутов, от которого зависят другие атрибуты) был потенциальным ключом. это устраняет все аномалии, связанные с зависимостями, даже в тех редких случаях, когда 3нф их не ловит
12. этапы проектирования бд
процесс проектирования бд обычно включает следующие этапы:

    концептуальное проектирование: определение требований, сущностей и связей между ними (обычно с помощью er-диаграмм), независимо от субд.
    логическое проектирование: перевод концептуальной модели в реляционную модель (таблицы, столбцы, ключи), все еще независимо от конкретной субд.
    физическое проектирование: реализация логической модели в конкретной системе управления базами данных (mssql, postgresql), выбор типов данных, индексов и партиционирования

13. внешний ключ (foreign key)
внешний ключ (fk) — это столбец или набор столбцов в одной таблице (дочерней), который ссылается на первичный ключ (или уникальный ключ) в другой таблице (родительской). он обеспечивает ссылочную целостность, гарантируя, что связанное значение существует в родительской таблице. например, id_comp в таблице trip ссылается на id_comp в таблице company
14. типы соединений таблиц
в sql существует несколько типов соединений для комбинирования строк:

    inner join: возвращает только те строки, для которых найдено совпадение в обеих таблицах.
    left outer join: возвращает все строки из левой таблицы и совпадающие строки из правой (несовпадающие будут null).
    right outer join: возвращает все строки из правой таблицы и совпадающие строки из левой.
    full outer join: возвращает все строки, когда есть совпадение в левой или правой таблице.
    cross join: возвращает декартово произведение, комбинируя каждую строку первой таблицы с каждой строкой второй

15. обработка ошибок в mssql
в transact-sql для обработки ошибок используется структурированный подход через блоки try...catch. код, который может вызвать ошибку, помещается в блок try. если ошибка возникает, управление передается в блок catch. внутри catch доступны системные функции, такие как error_message() (текст ошибки), error_number() (номер ошибки), error_line() (строка кода). команда throw используется для принудительного вызова ошибки
16. работа со значениями null
null обозначает отсутствие данных или неизвестное значение. при работе с null важно помнить:

    при сравнении с null нужно использовать is null или is not null, а не операторы = или <>.
    агрегатные функции (sum, avg, count) по умолчанию игнорируют null значения.
    для замены null на другое значение используются функции isnull(check_expression, replacement_value) (mssql specific) или coalesce(val1, val2, ...) (ansi standard)

17. подзапросы в sql
подзапрос (subquery) — это sql-запрос, вложенный внутрь другого запроса (select, insert, update, delete). они могут возвращать одно значение (скалярный), одну строку, один столбец (список) или целую таблицу. подзапросы используются в секциях where (с in, exists, =, >), from (как временная таблица), select (как вычисляемое поле)
18. временные таблицы
временные таблицы хранят промежуточные результаты запросов и существуют ограниченное время. в mssql есть два типа:

    локальные (#table_name): существуют только в текущей сессии подключения и удаляются при закрытии сессии.
    глобальные (##table_name): видны всем сессиям и удаляются, когда их перестает использовать последний пользователь.
    альтернативой являются табличные переменные (@table_name), которые живут только внутри текущего блока кода (батча)

19. табличные пользовательские функции (udf)
табличные пользовательские функции (table-valued functions, tvf) — это функции, которые возвращают не скалярное значение, а целую таблицу данных. они ведут себя как представления (views), но могут принимать параметры. они используются для инкапсуляции сложной логики выборки. есть inline tvf (самые быстрые) и multi-statement tvf (похожи на процедуры, но медленнее)
20. использование псевдонимов (aliases)
псевдонимы (aliases) используются для временного переименования таблиц или столбцов в рамках одного запроса. это повышает читаемость кода, особенно при соединениях нескольких таблиц. синтаксис:

    select column as alias_name from table
    select * from table as t1 join table2 as t2 on t1.id = t2.id
    псевдонимы таблиц обычно короткие (p, pc, t, c)

21. сохранение результата запроса в таблицу
в sql можно сохранить результат выполнения select в новую таблицу. есть два основных способа:

    select ... into new_table ...: создает новую таблицу на лету с нужной структурой и заполняет ее данными.
    insert into existing_table (...) select ...: вставляет данные в уже существующую таблицу с заранее определенной структурой

22. изменение данных и объектов бд
изменение данных и объектов происходит с помощью команд dml и ddl:

    update table set column = value where condition: изменяет существующие записи.
    insert into table (columns) values (values): добавляет новые записи.
    delete from table where condition: удаляет существующие записи.
    alter table table_name add column ... / alter table table_name drop column ...: изменяет структуру таблицы

23. агрегатные функции
агрегатные функции выполняют вычисления над набором значений и возвращают одно итоговое значение. они часто используются с group by. основные функции:

    count(): считает количество строк.
    sum(): суммирует значения.
    avg(): вычисляет среднее арифметическое.
    min(): находит минимальное значение.
    max(): находит максимальное значение
    они игнорируют null значения, если не указано обратное (count(*))

24. оконные функции
оконные функции выполняют вычисления над определенным набором строк (окном), связанных с текущей строкой. они не схлопывают строки в одну (в отличие от агрегатных функций с group by). синтаксис: function() over (partition by ... order by ...). используются для ранжирования, скользящих средних, накопленных сумм. примеры: row_number(), rank(), sum() over(...)
25. скалярные пользовательские функции (udf)
скалярные пользовательские функции (scalar functions) — это функции, которые принимают ноль или более параметров и возвращают ровно одно скалярное значение (например, int, varchar, datetime). они используются как часть выражения, например, в select или where. в mssql при вызове обычно требуется указывать схему: select dbo.get_total_price(id) from orders
26. фильтрация данных в запросах
фильтрация данных в sql происходит в основном с помощью двух ключевых слов:

    where: фильтрует отдельные строки до их агрегации или группировки. здесь нельзя использовать агрегатные функции.
    having: фильтрует группы строк после их агрегации и группировки (group by). здесь можно и нужно использовать агрегатные функции (например, having count(*) > 1)

27. команды для работы с данными в sql
команды для работы с данными составляют язык dml:

    select: извлечение данных из бд.
    insert: добавление новых строк в таблицу.
    update: изменение существующих строк.
    delete: удаление существующих строк из таблицы

28. работа с переменными в sql
в transact-sql переменные объявляются с использованием префикса @ и команды declare. им присваивается определенный тип данных. синтаксис:
sql

declare @my_var int;
set @my_var = 10;
print @my_var;

Use code with caution.
они используются для хранения промежуточных результатов, параметров процедур и управления ходом выполнения скриптов
29. представления (view)
представление (view) — это виртуальная таблица, основанная на результате sql-запроса. оно не хранит данные физически (обычно), но ведет себя как реальная таблица. представления используются для упрощения сложных запросов, ограничения доступа к данным (скрывая столбцы) и обеспечения совместимости приложений. создание: create view view_name as select ...
30. способы избавления от повторяющихся записей в запросе
для получения только уникальных строк в результате запроса используются следующие методы:

    distinct: ключевое слово, помещаемое сразу после select, которое отфильтровывает все строки, полностью совпадающие по всем полям.
    group by: группировка по всем столбцам запроса также гарантирует уникальность каждой строки в итоговом наборе.
    union (вместо union all): оператор объединения результатов двух select, который автоматически удаляет дубликаты между наборами данных

31. хранимые процедуры
хранимая процедура (stored procedure) — это предварительно скомпилированный набор инструкций sql и логики управления потоком (if/else, циклы), который хранится в базе данных. они вызываются по имени (exec procedure_name). используются для повышения производительности, безопасности и инкапсуляции бизнес-логики. могут принимать входные и выходные параметры
32. использование команд dml внутри пользовательской функции
внутри пользовательских функций (udf) в mssql существуют строгие ограничения. команды insert, update, delete (dml) и create, alter, drop (ddl) запрещены. функции должны быть "чистыми" и не изменять состояние базы данных. для изменения данных используются хранимые процедуры или триггеры
33. использование подзапросов в операторах сравнения
подзапросы часто используются в секции where для сравнения значений. они могут применяться с простыми операторами:

    =, >, <, >=, <=, <>: если подзапрос возвращает ровно одно значение (скалярный подзапрос).
    in, not in: если подзапрос возвращает список значений.
    exists, not exists: проверяет наличие хотя бы одной строки в подзапросе.
    any, all: для сравнения с любым или со всеми значениями в списке, возвращенном подзапросом

34. группировка в запросах
группировка в запросах осуществляется с помощью предложения group by. оно объединяет строки, имеющие одинаковые значения в указанных столбцах, в одну сводную строку. это позволяет применять агрегатные функции (sum, avg, count) к каждой группе отдельно. например, group by maker для подсчета средней цены каждого производителя
35. функция count()
функция count() используется для подсчета количества строк или значений. варианты использования:

    count(*): считает общее количество строк в группе, включая те, где есть null.
    count(column_name): считает количество строк, в которых указанный столбец не равен null.
    count(distinct column_name): считает количество уникальных не-null значений в столбце

36. операторы работы с множествами
операторы работы с множествами объединяют или сравнивают результаты двух независимых запросов select. для работы требуется одинаковое количество столбцов и совместимые типы данных. операторы:

    union: объединяет результаты, удаляя дубликаты.
    union all: объединяет результаты, сохраняя дубликаты (быстрее, если дубликаты не нужны).
    intersect: возвращает только строки, присутствующие в обоих запросах.
    except (или minus в oracle): возвращает строки из первого запроса, которых нет во втором

37. функции ранжирования
функции ранжирования используются в оконных функциях для присвоения номера или ранга каждой строке в определенном окне или группе. основные функции в mssql:

    row_number(): присваивает уникальный последовательный номер (1, 2, 3, 4...).
    rank(): присваивает ранг, при совпадении значений ранги одинаковые, но следующий ранг пропускается (1, 1, 3, 4...).
    dense_rank(): присваивает ранг, при совпадении значений ранги одинаковые, следующий ранг не пропускается (1, 1, 2, 3...)

38. команды ddl
команды ddl (data definition language) используются для определения, изменения и удаления объектов базы данных и их структуры. основные команды:

    create: создание нового объекта (create table, create view, create index).
    alter: изменение структуры существующего объекта (alter table add column...).
    drop: безвозвратное удаление объекта из бд (drop table table_name).
    truncate table: быстрая очистка всех данных в таблице с пересбросом счетчиков identity

39. виды ключей в реляционных субд
ключи обеспечивают связи и целостность данных. основные виды:

    первичный ключ (primary key): уникальный идентификатор строки.
    внешний ключ (foreign key): ссылка на pk другой таблицы.
    составной ключ (composite key): ключ, состоящий из нескольких столбцов.
    потенциальный ключ (candidate key): любой столбец или набор столбцов, который потенциально может быть pk.
    альтернативный ключ (alternate key): потенциальный ключ, который не был выбран в качестве первичного

40. связанные таблицы
связанные таблицы — это таблицы, между которыми установлена логическая связь с помощью внешнего ключа. связи бывают:

    один-ко-многим (1:m): одна запись в родительской таблице связана с несколькими записями в дочерней (компания и множество рейсов).
    один-к-одному (1:1): редкий тип связи, когда одна запись в одной таблице соответствует одной записи в другой.
    многие-ко-многим (m:m): реализуется через промежуточную (связующую) таблицу, которая содержит внешние ключи обеих связанных таблиц (пассажиры и рейсы связаны через pass_in_trip)

41. ограничения уникальности
ограничение unique гарантирует, что все значения в столбце или наборе столбцов уникальны по всей таблице. в отличие от первичного ключа:

    таблица может иметь несколько ограничений unique.
    столбец с unique может содержать одно значение null (в mssql, в отличие от ansi стандарта).
    оно предотвращает дублирование данных в конкретном поле

42. удаление данных и объектов бд
для удаления используются команды dml и ddl:

    delete from table where condition: удаляет строки данных из таблицы (dml).
    drop table table_name: удаляет саму таблицу и все ее данные без возможности восстановления (ddl).
    truncate table table_name: удаляет все строки в таблице очень быстро, но не может использоваться с таблицами, на которые ссылаются внешние ключи, без их предварительного отключения или удаления

43. оператор объединения
оператор union объединяет результаты двух или более запросов select в один результирующий набор. он автоматически удаляет дублирующиеся строки между результатами запросов. для включения дубликатов используется union all. оба оператора требуют, чтобы объединяемые запросы имели одинаковое количество столбцов с совместимыми типами данных в соответствующих позициях
44. типы пользовательских функций
пользовательские функции (udf) в mssql делятся на три основных типа:

    скалярные функции (scalar functions): возвращают одиночное значение (int, varchar и т.д.).
    табличные функции (table-valued functions, tvf): возвращают набор данных в виде таблицы (inline или multi-statement).
    агрегатные функции (aggregate functions): пользовательские функции, работающие как count() или sum(), но их создание сложнее и требует .net

45. способы возврата данных из хранимой процедуры
хранимая процедура может возвращать данные несколькими способами:

    через select: наиболее распространенный способ — процедура просто выполняет select и возвращает результирующий набор данных.
    через выходные параметры (output parameters): значения переменных, переданных в процедуру, могут быть изменены внутри и возвращены вызывающей стороне.
    через return: возвращает целочисленный код состояния выполнения (обычно 0 при успехе, или номер ошибки)

46. полный синтаксис команды select
полный синтаксис select в sql:

select [distinct] columns/expressions
from table1
join table2 on join_condition
where condition
group by columns
having condition
order by columns [asc/desc]
offset n rows fetch next m rows only;

порядок выполнения операций в этом запросе строго определен

47. полный синтаксис команды insert
полный синтаксис команды insert:

insert into table_name (column1, column2, ...)
values (value1, value2, ...);

или для вставки результата запроса:

insert into table_name (column1, column2, ...)
select value1, value2, ... from other_table;

48. полный синтаксис команды update
полный синтаксис команды update:

update table_name
set column1 = value1, column2 = value2, ...
where condition;

условие where обязательно, иначе будут обновлены все строки в таблице

49. полный синтаксис команды delete
полный синтаксис команды delete:

delete from table_name
where condition;

условие where обязательно, иначе будут удалены все строки в таблице

50. обобщенные табличные выражения (cte)
обобщенные табличные выражения (common table expressions, cte), используемые с ключевым словом with, создают временный именованный набор результатов запроса, который существует только на время выполнения одного следующего за ним запроса select, insert, update или delete. синтаксис: with cte_name as (select ...) select ... from cte_name; они используются для повышения читаемости сложных запросов, рекурсивных запросов и замены подзапросов в from

51. функции для работы со значениями типа datetime
в sql server для работы с датами используются функции:

    getdate() / sysdatetime(): текущая дата и время сервера.
    year(date), month(date), day(date): извлечение компонентов даты.
    dateadd(interval, number, date): добавление интервала ко времени (например, 5 дней).
    datediff(interval, date1, date2): разница между двумя датами в указанных единицах (дни, месяцы, годы).
    datename(interval, date): возвращает название интервала (например, 'monday')

52. оценка количества строк для каждого типа соединения
оценка количества строк в результирующем наборе данных:

    inner join: не больше, чем в наименьшей таблице (при условии связи один-ко-многим).
    left/right join: равно количеству строк в левой/правой таблице соответственно.
    full outer join: равно сумме строк из обеих таблиц минус количество совпадений.
    cross join: произведение количества строк обеих таблиц (n * m строк)

53. варианты действий с дочерней таблицей при dml в родительской
при определении внешнего ключа можно указать каскадные действия (on update/delete):

    no action (по умолчанию): запрещает изменение/удаление в родительской, если есть связанные записи в дочерней таблице (выдает ошибку).
    cascade: автоматически применяет то же изменение/удаление к связанным записям в дочерней таблице.
    set null: устанавливает значение внешнего ключа в дочерней таблице в null при изменении/удалении в родительской (требует разрешения null в поле fk).
    set default: устанавливает значение внешнего ключа в значение по умолчанию при изменении/удалении в родительской

54. оператор case
оператор case реализует условную логику (if-then-else) внутри запроса sql. он используется для создания вычисляемых столбцов на лету. синтаксис:

case 
  when condition1 then result1
  when condition2 then result2
  else final_result
end as column_alias

55. вызов пользовательских функций
вызов пользовательских функций (udf) зависит от их типа:

    скалярные функции: вызываются в выражениях select, where, set. в mssql обычно требуется указывать схему: select dbo.get_age(birthday) from employees;.
    табличные функции: вызываются в предложении from так же, как обычные таблицы, и могут быть присоединены (join): select ... from dbo.get_orders_by_date('2026-01-01') as orders;

56. вызов хранимой процедуры
вызов хранимой процедуры осуществляется с помощью команды exec или execute. синтаксис:

exec procedure_name parameter1_value, parameter2_value, ...;

Use code with caution.
для процедур с выходными параметрами синтаксис сложнее: exec procedure_name @input_param = 1, @output_param = @var output;
57. извлечение диапазона строк в ms sql server
для реализации пагинации (вывода диапазона строк) в mssql 2012+ используется стандартный ansi sql синтаксис offset ... fetch next ... only. он должен использоваться только в конце запроса, после обязательного предложения order by:
sql

select * from table_name
order by id_comp
offset 10 rows fetch next 20 rows only;
